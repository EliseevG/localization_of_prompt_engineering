# Перевод текста

## Промпт

    Промпт
    Инженерия
    Автор: Ли Бунстра

## Благодарности

    Содержательные участники
    Майкл Шерман
    Юань Цао
    Эрик Армбруст
    Ананта Навагариа
    Антонио Гулли
    Симона Каммел

    Кураторы и редакторы
    Антонио Гулли
    Ананта Навагариа
    Грейс Моллисон
    
    Технический писатель
    Джоуи Хеймекер

    Дизайнер
    Майкл Ланнинг

## Введение

    Когда речь идет о вводе и выводе большой языковой модели, текстовый промпт 
    (иногда сопровождаемый другими модальностями, такими как изображения) является 
    входными данными, которые модель использует для предсказания конкретного вывода. 
    Вам не нужно быть специалистом по данным или инженером машинного обучения – 
    каждый может написать промпт. Однако создание наиболее эффективного промпта 
    может быть сложным. Многие аспекты вашего промпта влияют на его эффективность: 
    модель, которую вы используете, обучающие данные модели, конфигурации модели, 
    ваш выбор слов, стиль и тон, структура и контекст имеют значение. Поэтому 
    инженерия промптов – это итеративный процесс. Неадекватные промпты могут 
    привести к неоднозначным, неточным ответам и могут затруднить способность 
    модели предоставлять значимый вывод.

## Одиночный и несколько выстрелов

    При создании промптов для AI моделей полезно предоставлять примеры. Эти примеры 
    могут помочь модели понять, что вы от нее хотите. Примеры особенно полезны, 
    когда вы хотите направить модель к определенной структуре или шаблону вывода. 
    Промпт одиночного выстрела предоставляет один пример, отсюда и название 
    "одиночный выстрел". Идея заключается в том, что у модели есть пример, который 
    она может имитировать, чтобы наилучшим образом выполнить задачу. Промпт 
    нескольких выстрелов предоставляет модели несколько примеров. Этот подход 
    показывает модели шаблон, который ей нужно следовать. Идея схожа с одиночным 
    выстрелом, но несколько примеров желаемого шаблона увеличивают вероятность 
    того, что модель будет следовать этому шаблону.

## Системный, контекстуальный и ролевой промптинг

    Системный, контекстуальный и ролевой промптинг — это техники, используемые для 
    управления тем, как LLM генерируют текст, но они фокусируются на разных аспектах. 
    Системный промпт задает общий контекст и цель для языковой модели. Он определяет 
    «большую картину» того, что модель должна делать, например, переводить язык, 
    классифицировать рецензию и т. д. Контекстуальный промпт предоставляет конкретные 
    детали или фоновую информацию, относящуюся к текущему разговору или задаче. Он 
    помогает модели понять нюансы того, что запрашивается, и адаптировать ответ 
    соответственно. Ролевой промпт назначает конкретный характер или идентичность, 
    которую языковая модель должна принять. Это помогает модели генерировать ответы, 
    которые соответствуют назначенной роли и ее сопутствующим знаниям и поведению.

## Промптинг с шагом назад

    Промптинг с шагом назад — это техника, направленная на улучшение производительности, 
    при которой LLM сначала рассматривает общий вопрос, связанный с конкретной задачей, 
    а затем ответ на этот общий вопрос вводится в последующий промпт для конкретной 
    задачи. Этот «шаг назад» позволяет LLM активировать соответствующие фоновые знания 
    и процессы рассуждения перед тем, как пытаться решить конкретную проблему. 
    Рассматривая более широкие и основные принципы, LLM могут генерировать более точные 
    и глубокие ответы. Промптинг с шагом назад побуждает LLM мыслить критически и 
    применять свои знания новыми и креативными способами.

## Цепочка размышлений (CoT)

    Промптинг цепочки размышлений (CoT) — это техника, направленная на улучшение 
    способностей рассуждения LLM путем генерации промежуточных шагов рассуждения. 
    Это помогает LLM генерировать более точные ответы. Вы можете комбинировать это 
    с промптингом с несколькими выстрелами, чтобы получить лучшие результаты по 
    более сложным задачам, которые требуют рассуждений перед ответом.

## Автоматическая инженерия промптов

    На этом этапе вы можете осознать, что написание промпта может быть сложным. 
    Разве не было бы здорово автоматизировать это (написать промпт для написания 
    промптов)? Что ж, существует метод: Автоматическая инженерия промптов (APE). 
    Этот метод не только устраняет необходимость в человеческом вмешательстве, но и 
    улучшает производительность модели в различных задачах.

    Промптинг кода
    Gemini в первую очередь ориентирован на текстовые промпты, что также включает 
    написание промптов для возвращения кода. Давайте перейдем в Vertex AI Studio и 
    протестируем эти промпты, чтобы посмотреть на некоторые примеры кода.

    Промпты для написания кода
    Gemini также может быть разработчиком и помочь вам с написанием кода на любом 
    языке программирования по вашему выбору. Как разработчик, это может помочь вам 
    ускорить процесс написания кода. Представьте себе папку на вашем компьютере с 
    сотнями файлов, которые нужно переименовать. Переименование каждого файла займет 
    у вас много времени. Вы немного знаете Bash и могли бы написать скрипт для 
    автоматизации этого, но это тоже может занять некоторое время. Так что давайте 
    напишем промпт. Вы можете написать промпт в публичном потребительском чат-боте 
    Gemini, или если вас больше беспокоит конфиденциальность, вы можете написать эти 
    промпты в своем аккаунте Google Cloud и открыть Vertex AI Studio. Преимущество 
    Vertex AI Studio в том, что вы можете настроить температуру и т. д.

    Это кажется хорошим кодом - он даже задокументирован! Однако, поскольку LLM не 
    могут рассуждать и повторяют обучающие данные, важно сначала прочитать и 
    протестировать ваш код. Момент, которого мы все ждем: действительно ли это 
    работает?

    Давайте сначала попробуем с тестовой папкой, в которой всего несколько файлов, 
    которые нужно переименовать с filename.txt на draft_filename.txt.
    1. Скопируйте вывод из Таблицы 16 (без текстового обрамления ```bash ```) и 
       вставьте его в новый файл с именем: "rename_files.sh".
    2. Откройте окно терминала и введите: . rename_files.sh. Он попросит ввести имя 
       папки, например, test, и нажмите Enter.
    3. Скрипт, похоже, работает нормально. Вы увидите сообщение: Файлы успешно 
       переименованы. Когда вы посмотрите в тестовую папку, обратите внимание, что 
       все файлы были идеально переименованы в draft_filename.txt.
       Это сработало!

## Промпты для объяснения кода

    Как разработчик, работая в командах, вам нужно читать код других людей. Gemini 
    может помочь вам и с этим. Давайте возьмем вывод кода из Таблицы 16, уберем 
    комментарии и попросим большую языковую модель объяснить, что происходит. См. 
    Таблицу 17:

## Промпты для перевода кода

    Bash-код из Таблицы 16, похоже, работает нормально. Однако этот скрипт 
    действительно мог бы быть переиспользованным, если бы он запрашивал у меня имена 
    файлов; в идеале он должен работать как отдельное приложение с интерфейсом 
    пользователя. В качестве отправной точки Python был бы лучшим языком для (веб) 
    приложения, чем Bash. LLM могут помочь с переводом кода с одного языка на другой. 
    См. пример в Таблице 18:

    Прочитайте и проверьте код. Скопируйте вывод из промпта и вставьте его в новый 
    файл: file_renamer.py. Протестируйте код, открыв окно терминала и выполнив 
    следующую команду: python file_renamer.py.
    
    ПРИМЕЧАНИЕ: При запросе (Python) кода в Language Studio в Vertex AI вам нужно 
    будет нажать на кнопку «Markdown». В противном случае вы получите обычный текст, 
    в котором отсутствует правильное выравнивание строк, что важно для выполнения 
    Python-кода.

## Промпты для отладки и проверки кода

    Давайте вручную внесем некоторые изменения в код из Таблицы 18. Он должен 
    запрашивать у пользователя префикс имени файла и записывать этот префикс 
    заглавными буквами. См. пример кода в Фрагменте 3, но какая досада. Теперь он 
    возвращает ошибки Python!

    Python
    ```python
    import os
    import shutil
    
    folder_name = input("Введите имя папки: ")
    prefix = input("Введите строку, которую нужно добавить к имени файла: ")
    text = toUpperCase(prefix)
    
    if not os.path.isdir(folder_name):
        print("Папка не существует.")
        exit(1)
    
    files = os.listdir(folder_name)
    for file in files:
        new_filename = f"{text}_{file}"
        shutil.move(os.path.join(folder_name, file),
                    os.path.join(folder_name, new_filename))
    
    print("Файлы успешно переименованы.")
    ```

    Фрагмент 3. Неисправный Python-скрипт
    Упс! Это выглядит как ошибка:

    Ниже приведенный код Python вызывает ошибку:

    Traceback (most recent call last):
    File "/Users/leeboonstra/Documents/test_folder/rename_files.py", line 7,
    in <module>
    text = toUpperCase(prefix)
    NameError: name 'toUpperCase' is not defined

    Давайте вручную внесем некоторые изменения в код из Таблицы 18. Он должен 
    запрашивать у пользователя префикс имени файла и записывать этот префикс 
    заглавными буквами. См. пример кода в Фрагменте 3, но какая досада. Теперь он 
    возвращает ошибки Python!

    Фрагмент 4. Я сломал Python-код
    Давайте посмотрим, сможем ли мы попросить большую языковую модель отладить и 
    проверить код. Посмотрите на Таблицу 19:

## Что насчет мультимодального промптинга?

    Промптинг для кода по-прежнему использует ту же обычную большую языковую модель. 
    Мультимодальный промптинг является отдельной темой, он относится к технике, при 
    которой вы используете несколько форматов ввода для управления большой языковой 
    моделью, вместо того чтобы полагаться только на текст. Это может включать 
    комбинации текста, изображений, аудио, кода или даже других форматов, в 
    зависимости от возможностей модели и конкретной задачи.

## Лучшие практики

    Нахождение правильного промпта требует экспериментов. Language Studio в Vertex 
    AI — это идеальное место для экспериментов с вашими промптами, с возможностью 
    тестирования на различных моделях. Используйте следующие лучшие практики, чтобы 
    стать профессионалом в инженерии промптов.

### Предоставляйте примеры

    Самая важная лучшая практика — предоставлять (одиночные / несколько) примеры в 
    промпте. Это очень эффективно, потому что это служит мощным инструментом 
    обучения. Эти примеры демонстрируют желаемые результаты или аналогичные ответы, 
    позволяя модели учиться на них и адаптировать свое собственное поколение 
    соответственно. Это похоже на то, чтобы дать модели точку отсчета или цель, к 
    которой нужно стремиться, улучшая точность, стиль и тон ее ответа, чтобы лучше 
    соответствовать вашим ожиданиям.

### Проектируйте с простотой

    Промпты должны быть краткими, ясными и легкими для понимания как для вас, так и 
    для модели. В качестве правила, если это уже запутанно для вас, это, вероятно, 
    будет также запутанно для модели. Старайтесь не использовать сложный язык и не 
    предоставлять ненужную информацию.

    Примеры:
    **ДО:**
    Я сейчас в Нью-Йорке, и мне хотелось бы узнать больше о замечательных местах. 
    Я с двумя трехлетними детьми. Куда нам следует пойти во время нашего отпуска?

    **ПОСЛЕ ПЕРЕПИСКИ:**
    Действуйте как туристический гид. Опишите замечательные места для посещения в 
    Манхэттене, Нью-Йорк, с трехлетним ребенком.

    Попробуйте использовать глаголы, которые описывают действие. Вот набор примеров:
    Действовать, Анализировать, Классифицировать, Сравнивать, Создавать, Описывать, 
    Определять, Оценивать, Извлекать, Находить, Генерировать, Идентифицировать, 
    Перечислять, Измерять, Организовывать, Парсить, Выбирать, Предсказывать, 
    Предоставлять, Ранжировать, Рекомендовать, Возвращать, Извлекать, Переписывать, 
    Выбирать, Показывать, Сортировать, Резюмировать, Переводить, Писать.

### Будьте конкретными в отношении вывода

    Будьте конкретными в отношении желаемого вывода. Краткая инструкция может не 
    направить LLM достаточно или может быть слишком общей. Предоставление конкретных 
    деталей в промпте (через системный или контекстуальный промптинг) может помочь 
    модели сосредоточиться на том, что актуально, улучшая общую точность.

    Примеры:
    **ДЕЛАЙТЕ:**
    Сгенерируйте 3-параграфный блог-пост о 5 лучших игровых консолях. Блог-пост 
    должен быть информативным и увлекательным, и он должен быть написан в 
    разговорном стиле.

    **НЕ ДЕЛАЙТЕ:**
    Сгенерируйте блог-пост о игровых консолях.

### Используйте инструкции вместо ограничений

    Инструкции и ограничения используются в промптинге для управления выводом LLM.
    • Инструкция предоставляет явные указания по желаемому формату, стилю или 
      содержанию ответа. Она направляет модель на то, что модель должна делать или 
      производить.
    • Ограничение — это набор ограничений или границ на ответ. Оно ограничивает то, 
      что модель не должна делать или избегать.

    Исследования показывают, что сосредоточение на положительных инструкциях в 
    промптинге может быть более эффективным, чем сильная зависимость от ограничений. 
    Этот подход соответствует тому, как люди предпочитают положительные инструкции, 
    а не списки того, что не следует делать.
    Инструкции напрямую сообщают о желаемом результате, в то время как ограничения могут оставить
    модель в неведении относительно того, что разрешено. Это дает гибкость и поощряет креативность в рамках
    определенных границ, в то время как ограничения могут ограничивать потенциал модели. Также список ограничений
    может противоречить друг другу.
    Ограничения все еще ценны, но в определенных ситуациях. Чтобы предотвратить генерацию
    вредного или предвзятого контента или когда требуется строгий формат или стиль вывода.
    Если возможно, используйте положительные инструкции: вместо того чтобы говорить модели, что не делать, скажите ей, что делать вместо этого. Это может избежать путаницы и улучшить точность вывода.

    **ДЕЛАЙТЕ:**
    Сгенерируйте 1-параграфный блог-пост о 5 лучших игровых консолях. Обсуждайте 
    только консоль, компанию, которая ее сделала, год и общие продажи.

    **НЕ ДЕЛАЙТЕ:**
    Сгенерируйте 1-параграфный блог-пост о 5 лучших игровых консолях. Не 
    перечисляйте названия видеоигр.

    В качестве лучшей практики начните с приоритета инструкций, четко указывая, что 
    вы хотите, чтобы модель сделала, и используйте ограничения только тогда, когда 
    это необходимо для безопасности, ясности или специфических требований. 
    Экспериментируйте и итеративно тестируйте различные комбинации инструкций и 
    ограничений, чтобы найти то, что лучше всего работает для ваших конкретных 
    задач, и документируйте это.

### Контроль максимальной длины токенов

    Чтобы контролировать длину сгенерированного ответа LLM, вы можете либо 
    установить максимальный лимит токенов в конфигурации, либо явно запросить 
    определенную длину в вашем промпте. Например: "Объясните квантовую физику в 
    сообщении длиной в твит."

### Используйте переменные в промптах

    Чтобы повторно использовать промпты и сделать их более динамичными, используйте 
    переменные в промпте, которые можно изменять для различных входных данных. 
    Например, как показано в Таблице 20, промпт, который дает факты о городе. 
    Вместо того чтобы жестко кодировать название города в промпте, используйте 
    переменную. Переменные могут сэкономить вам время и усилия, позволяя избежать 
    повторений. Если вам нужно использовать одну и ту же информацию в нескольких 
    промптах, вы можете сохранить ее в переменной, а затем ссылаться на эту 
    переменную в каждом промпте. Это имеет смысл, когда вы интегрируете промпты в 
    свои собственные приложения.

### Экспериментируйте с форматами ввода и стилями написания

    Разные модели, конфигурации моделей, форматы промптов, выбор слов и отправки 
    могут давать разные результаты. Поэтому важно экспериментировать с атрибутами 
    промпта, такими как стиль, выбор слов и тип промпта (нулевой выстрел, несколько 
    выстрелов, системный промпт).

    Например, промпт с целью сгенерировать текст о революционной игровой консоли 
    Sega Dreamcast может быть сформулирован как вопрос, утверждение или инструкция, 
    что приведет к различным выводам:
    • Вопрос: Что такое Sega Dreamcast и почему она была такой революционной 
      консолью?
    • Утверждение: Sega Dreamcast была консолью шестого поколения, выпущенной 
      компанией Sega в 1999 году. Это...
    • Инструкция: Напишите один абзац, который описывает консоль Sega Dreamcast и 
      объясняет, почему она была такой революционной.

### Для промптинга с несколькими выстрелами в задачах классификации перемешивайте классы

    В общем, порядок ваших примеров с несколькими выстрелами не должен иметь 
    большого значения. Однако, при выполнении задач классификации убедитесь, что вы 
    перемешиваете возможные классы ответов в примерах с несколькими выстрелами. Это 
    связано с тем, что в противном случае вы можете переобучить модель на конкретный 
    порядок примеров. Перемешивая возможные классы ответов, вы можете убедиться, 
    что модель учится определять ключевые особенности каждого класса, а не просто 
    запоминает порядок примеров. Это приведет к более устойчивой и обобщаемой 
    производительности на невидимых данных.

### Хорошее правило — начинать с 6 примеров с несколькими выстрелами и тестировать точность с этого момента.

### Адаптируйтесь к обновлениям модели

    Важно следить за изменениями в архитектуре модели, добавленными данными и 
    возможностями. Пробуйте новые версии моделей и корректируйте свои промпты, 
    чтобы лучше использовать новые функции модели. Инструменты, такие как Vertex AI 
    Studio, отлично подходят для хранения, тестирования и документирования различных 
    версий вашего промпта.

### Экспериментируйте с форматами вывода

    Помимо формата ввода промпта, рассмотрите возможность экспериментов с форматом 
    вывода. Для не креативных задач, таких как извлечение, выбор, парсинг, 
    упорядочение, ранжирование или категоризация данных, попробуйте возвращать 
    вывод в структурированном формате, таком как JSON или XML.

    Существует несколько преимуществ в возврате объектов JSON из промпта, который 
    извлекает данные. В реальном приложении мне не нужно вручную создавать этот 
    формат JSON, я могу уже возвращать данные в отсортированном порядке (что очень 
    удобно при работе с объектами даты и времени), но самое главное, запрашивая 
    формат JSON, я заставляю модель создать структуру и ограничить галлюцинации.

    В заключение, преимущества использования JSON для вашего вывода:
    • Всегда возвращается в одном и том же стиле
    • Сосредоточение на данных, которые вы хотите получить

### Работа с схемами

    Использование структурированного JSON в качестве вывода — отличное решение, как 
    мы видели несколько раз в этом документе. Но что насчет ввода? Хотя JSON 
    отлично подходит для структурирования вывода, который генерирует LLM, он также 
    может быть невероятно полезен для структурирования ввода, который вы 
    предоставляете. 

    Здесь в игру вступают схемы JSON. Схема JSON определяет ожидаемую структуру и 
    типы данных вашего JSON-ввода. Предоставляя схему, вы даете LLM четкий план 
    данных, которые она должна ожидать, помогая ей сосредоточить внимание на 
    релевантной информации и снижая риск неправильной интерпретации ввода. Более 
    того, схемы могут помочь установить отношения между различными частями данных и 
    даже сделать LLM "осведомленной о времени", включая поля даты или времени с 
    определенными форматами.

    Вот простой пример:
    Предположим, вы хотите использовать LLM для генерации описаний продуктов в 
    каталоге электронной коммерции. Вместо того чтобы просто предоставлять 
    свободное текстовое описание продукта, вы можете использовать схему JSON, чтобы 
    определить атрибуты продукта:

    Фрагмент 5. Определение схемы структурированного вывода

    Затем вы можете предоставить фактические данные о продукте в виде объекта JSON, 
    который соответствует этой схеме:

### Экспериментируйте вместе с другими инженерами промптов

    Если вы находитесь в ситуации, когда вам нужно попытаться придумать хороший промпт, вы можете
    попробовать найти несколько
(как указано в этой главе), вы увидите различия в производительности между всеми
разными попытками промптов.

### Лучшие практики CoT

    Для промптинга CoT необходимо помещать ответ после рассуждения, потому что 
    генерация рассуждения изменяет токены, которые модель получает, когда 
    предсказывает финальный ответ.

    С помощью CoT и самосогласованности вам нужно уметь извлекать финальный ответ 
    из вашего промпта, отделяя его от рассуждения.

    Для промптинга CoT установите температуру на 0. Промптинг цепочки размышлений 
    основан на жадном декодировании, предсказывая следующее слово в 
    последовательности на основе наивысшей вероятности, присвоенной языковой 
    моделью. В общем, при использовании рассуждений, чтобы прийти к финальному 
    ответу, вероятно, есть один единственный правильный ответ. Поэтому температура 
    всегда должна быть установлена на 0.

### Документируйте различные попытки промптов

    Последний совет уже упоминался в этой главе, но мы не можем не подчеркнуть, 
    насколько это важно: документируйте свои попытки промптов в полном объеме, 
    чтобы со временем вы могли узнать, что сработало, а что нет.

    Выводы промптов могут различаться между моделями, между настройками выборки и 
    даже между разными версиями одной и той же модели. Более того, даже при 
    идентичных промптах к одной и той же модели могут возникать небольшие различия 
    в форматировании выходных предложений и выборе слов. (Например, как упоминалось 
    ранее, если два токена имеют одинаковую предсказанную вероятность, разрешение 
    споров может происходить случайным образом. Это может повлиять на последующие 
    предсказанные токены.)

### Рекомендации по созданию таблицы

    Мы рекомендуем создать Google Таблицу с Таблицей 21 в качестве шаблона. 
    Преимущества такого подхода заключаются в том, что у вас будет полный отчет, 
    когда вам неизбежно придется вернуться к вашей работе с промптами — либо чтобы 
    продолжить ее в будущем (вы будете удивлены, насколько много можно забыть после 
    короткого перерыва), чтобы протестировать производительность промпта на разных 
    версиях модели и помочь отладить будущие ошибки.

    Помимо полей в этой таблице, также полезно отслеживать версию промпта 
    (итерацию), поле для указания, был ли результат ОК/НЕ ОК/ИНАЧЕ ОК, и поле для 
    обратной связи. Если вам повезло использовать Vertex AI Studio, сохраните свои 
    промпты (используя то же имя и версию, что указаны в вашей документации) и 
    отслеживайте гиперссылку на сохраненный промпт в таблице. Таким образом, вы 
    всегда будете на шаг ближе к повторному запуску ваших промптов.

    При работе с системой, основанной на дополненной генерации, вам также следует 
    зафиксировать конкретные аспекты системы RAG, которые влияют на то, какой 
    контент был вставлен в промпт, включая запрос, настройки фрагментов, вывод 
    фрагментов и другую информацию.

    Как только вы почувствуете, что промпт близок к совершенству, перенесите его в 
    вашу кодовую базу. И в кодовой базе сохраняйте промпты в отдельном файле от 
    кода, чтобы их было легче поддерживать. Наконец, в идеале ваши промпты должны 
    быть частью операционной системы, и как инженер промптов вы должны опираться на 
    автоматизированные тесты и процедуры оценки, чтобы понять, насколько хорошо 
    ваш промпт обобщается на задачу.

    Инженерия промптов — это итеративный процесс. Создавайте и тестируйте различные 
    промпты, анализируйте и документируйте результаты. Уточняйте свой промпт на 
    основе производительности модели. Продолжайте экспериментировать, пока не 
    достигнете желаемого вывода. Когда вы изменяете модель или конфигурацию модели, 
    возвращайтесь и продолжайте экспериментировать с ранее использованными 
    промптами.

### Резюме

    Этот документ обсуждает инженерию промптов. Мы изучили различные техники 
    промптинга, такие как:
    • Нулевой промптинг
    • Промптинг с несколькими выстрелами
    • Системный промптинг
    • Ролевой промптинг
    • Контекстуальный промптинг
    • Промптинг с шагом назад
    • Цепочка размышлений
    • Самосогласованность
    • Дерево размышлений
    • ReAct

    Мы также рассмотрели способы автоматизации ваших промптов.

    Документ затем обсуждает проблемы генеративного ИИ, такие как проблемы, которые 
    могут возникнуть, когда ваши промпты недостаточны. Мы завершили обсуждение 
    лучшими практиками о том, как стать лучшим инженером промптов.
